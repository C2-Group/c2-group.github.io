
# 态势认知——理解

## 概述

随着网络入侵行为趋于规模化、复杂化、间接化，国家间信息对抗形势逐渐严峻，对网络安全技术提出了更高的要求。与对已产生的攻击行为进行取证和控制相比，态势认知和理解技术能够主动地收集动态的网络态势信息，分析并准确预测帮助管理员做出准确防御和应急性决策，具有重要的意义。

在对网络态势感知的研究中，前美国空军首席科学家Mica R. Endsley和作为网络态势感知研究领域基础奠基人的美国网络中心前安全首席顾问的Tim Bass，所提出的Endsley三层模型和Tim Bass模型为网络态势感知领域内理论和技术的发展提供了参考和借鉴。后续文章都是基于两种模型形成了衍生的态势感知技术或理论模型，因此，对Tim Bass模型和Endsley三级模型的准确理解和应用是网络态势感知研究的根本和基础。

Endsley三级模型包括：态势要素感知、态势理解、态势预测。它是目前国际上应用最广的一种态势感知认知模型，沿着信息处理链，第一级是对环境中各成分的感知（信息的输入），第二级是对目前的环境的综合判断和理解（信息的处理），第三级是对随后环境的预测和推理（信息的输出）。下面根据这三级对研究点进行梳理。


## 研究选题

## 1、环境中各成分的感知 ##

1. 内部威胁感知

实际网络空间（战场环境）环境具有环境动态，数据海量的特点。如，在IDC网中，业务不同的节点之间一般不存在关联，但IDC又是通的，黑客会渗透，因此可能产生不应该有的关联。OA内网中，员工间的异常交互行为也可能意味着高的内部风险；用户对数据的访问行为，也是数据防护中的分析重点。0-day的漏洞，超出预期，只能通过（关键）行为进行检测，通过采集端、服务，做异常分析，不是基于安全的分析，可能检测出很多的异常，如何理解这些异常，是一个挑战。该选题研究如何从宏观的层面、以全局的视角感知异常，再进行有效的追溯？如当发现有新的链接，根据整体拓扑的情况，判断有没有问题。难点在自动化的处理，目前还没有对内网拓扑进行知识化，代价大。主要考虑核心的、高危的，覆盖关键的子域。如何基于行为分析，判断数据面临的风险/关键性？

近年来，斯诺登、曼宁等泄密事件证明，“人”的行为是网络空间安全问题的关键要素，网络空间的安全威胁将主要源于内部，特别是拥有合法权限的内部人员的恶意攻击和窃密行为，然而传统的安全方法没有考虑，也无法分析具有合法权限内部人员的恶意行为。因此，在动态、多域条件下的网络空间用户行为分析至关重要，否则将造成网络防御的巨大漏洞。贝叶斯网络可以较好的应用在态势感知以及行为分析问题中，但是在应用过程中，如何根据已有的数据和知识，构建网络有向无环的拓扑结构（Directed Acyclic Graph，DAG）和节点间条件概率影响程度（Conditional Probability Table，CPT），即贝叶斯网络学习，具有很强的挑战性。这是因为，在学习过程中，由于候选DAG结构的数量会随着节点数的增加而指数倍增加，因此BN学习是NP难问题。在实际应用中，模型的构建需要考虑数据和领域知识的结合，且搜索空间庞大，因此传统的贝叶斯网络研究，特别是模型学习研究在最近几年出现了一定的停滞。具体地，本课题以网络空间内部威胁检测为背景，以提高贝叶斯网络学习精度为目标，在现有单任务（单问题域）学习算法的基础上，通过引入多任务（多问题域）的学习框架，研究多任务条件下任务相似度计算、任务求解、以及支持知识和数据混合下学习的实现途径。研究贝叶斯网络对领域知识和用户行为的建模方法，在已有指标的基础上，结合心理域与社会域，建立了预测网络中恶意用户动机和心理。研究多任务条件下贝叶斯网络的近似推理算法，以及关键证据集的分析方法，并结合内部威胁检测应用，构造综合考虑学习算法性能和实际应用绩效的评价体系，通过公开模型数据集和实际应用实验，探索多任务条件下的模型学习有效模式，以及学习任务、领域知识和算法效能之间的关系，为不确定环境下态势感知系统的分析和设计提供理论与方法支撑，为安全防护决策提供支持。
 
2. 安全事件关联聚合

目前采集的数据都比较底层，告警太多，需要向上聚合，比如XSS攻击进来，意味什么？如何结合本体提高安全事件聚合准确率，形成包、事件、计划、意图，立体的结构。这里检测是跨层的，可以同时利用level 0 + 3 的数据，需要灵活的选择数据源，进行组装，图的结构，看到的是data source，数据源的发现和使用机制，看起来是分布式的SIEM，计算和存储是分布的数据来源是动态抓出来的动态实时数据，也可以是半离线化的数据。通过安全知识、情报库的建设，构建知识网，形成关键事件关联。

## 2、环境的综合判断和理解 ##

1. 对抗条件下的威胁检测与判断

目前的威胁检测准确性，从过去的40-50%提升到70-80%。再往后，对抗强度提升，真正的高级威胁周期很长，机器学习模型如何应对这种挑战？目前对抗条件下的机器学习问题处于寻找新应用场景和不断尝试新算法的阶段，还未形成完整体系。和攻击与生俱来的还有防御问题，现阶段防御问题基本还处于把对抗样本加入原始数据一起训练以此来防御攻击的状态，研究的人很少，也没有十分显著的效果。说明在这个领域还有很大的可挖掘的空间。在机器学习发展飞速的今天，安全性问题正逐渐进入人们的的视野，对抗攻击不只能够在网络空间进行攻击，还能够在物理世界中任何使用到机器学习的场景中进行有效攻击，比如针对人脸识别、语音识别的攻击。因此该方向的研究具有重要的前沿性和巨大的应用价值。

2. 关键资产分析
关键资产是网络环境综合判断理解的重要内容。因此，如何利用传统的网络模型以及机器学习方法，找寻关键节点，并对其行为进行分析具有十分重要的作用。本课题基于解释结构模型ISM与结构洞理论组合模型对网络节点重要性评估进行研究。学习解释结构模型和结构洞理论的背景知识，同时学习相关定义和评价准则；研究机器学习方法，如Credal Network、Sum-product Network的特点，以及如何与解释结构模型结合的方法；研究模型的评估方法，并给出相关定义和评判标准；研究实验的设计和测试方法；研究网络的稳定性和网络结构洞数量之间的关系，通过主动删减网络结构洞节点进行实验仿真，并对结果进行分析。具体地，ISM模型能够将网络划分成不同的层级，层级越高节点重要度越大，反之，节点越不重要。结构洞模型能够衡量节点在网络中的重要性，网络约束系数反映节点形成结构洞的难易程度，通过计算节点的网络约束系数来判断节点的重要性，节点网络系数越小则节点形成结构洞的可能性越大，即关键资产的重要性越大，反之，则不重要。ISM模型和结构洞模型都具有各自的优点，将两者结合起来对网络中的节点进行重要性分析会得到更加理想的结果。同时引入机器学习的方法，提高模型的可解释性，增加不确定性表达，从而使关键资产的重要性判断更加合理。

## 3、环境的预测和推理 ##

1. 安全风险评价与BN结构理论研究

在感知关键数据的基础上，如何分析面临的是什么风险？如何从顶层描述内网整体的安全情况？如，假设一台机器被攻陷，如何从整体判断面临的风险？如何回答，对于安全风险、能力，做了什么事情，让风险可控？要从黑客的角度，看我们的风险，有没有漏洞可以利用，是不是黑客想获取的东西？是不是黑客所需要的，对数据的认知，与业务关联在一起，如何看待？资产能否被利用，是否能够被黑客所需要？该研究点的核心是风险的量化评价。可与关键资产识别结合起来，结合主机上的指纹、权限、数据类型、漏洞、内部危险操作等结合考虑（关键资产画像与识别/评估方法研究），将关键性评估和异常行为检测有效结合，进而设计具体的风险量化指标，实现风险评价。

BN模型是一种常用的安全风险评价模型，其难点在于结构学习。现有优化方法的弊端在于不能有效达到无环性约束，无约束算法，如梯度下降法，显然不能达到这个约束条件。由于无环性约束是非凸的，不能准确定义投影算子，因此投影方法不能充分解决这一问题。我们需要研究专门的优化方法来有效达到无环性约束。现有的方法包括分支-切割法、动态规划法、A*搜索法、贪心算法、坐标下降法等。目前在不同结构和统计假设的情况下学习DAGs的算法都取得了很大的进步。从现有的所有机器算法中我们可以看出，这些模型的成功之处在于都具有一个封闭的形式、对于现有优化技术来说容易处理。对于无向图来说主要的技术是凸优化。可是DAG学习算法显然不能直接使用这些优化算法，因为它涉及的问题是不易处理的。这就导致了启发式算法的大量应用，总是从优化方法中提取工具，但还是要依靠启发式方法来给算法提速。广泛的来说，现有方法可以分成估计算法和精确算法，后者能够保证返回一个全局最优解。精确算法能够形成一类方法，但它们都是围绕着NP难的组合优化问题，这些方法在计算普遍不容易实现。可以说目前最流行的优化方法都包括局部搜索，也就是边和父节点集都是有序增加，一次只增加一个节点。只要每个节点只有少量的父节点时，这种方法就是有效的。但随着可能的父节点数增加，局部搜索很快不易处理。此外，这种策略非常依赖严格的结构假设，显然这些严格的假设难以达到并且不可能验证。因此，找到能够进行全局搜索的算法也是个关键的研究点。关于DAG学习的文献可以划分为在离散数据上处理和在连续数据上处理。许多方法仅能够在非常特定的数据上有效，因此找到不依赖于特定模型假设的一般方法也是个重要的研究点。最后一点是，现有方法最重要的弊端是它的概念非常复杂，需要相关人员具有非常了解图模型，这些方法还涉及到许多非常强的技巧。因此，如何建立一个能够让不了解图模型的人也能明白的数学模型也至关重要。

具体地，本课题以贝叶斯网络的结构学习为主要研究内容，以安全风险评价为研究目标，在现有局部启发式算法的基础上，引入数值优化的相关知识，研究能够对DAG结构进行全局最优学习的算法。在已有的外部攻击检测的基础上，结合网络安全等相关知识和公开数据集，验证贝叶斯网络结构学习的实际应用效果，并针对实验结果进行改进。


2. 漏洞预测与系统威胁评估

漏洞（vulnerability）是指在硬件、软件、协议的具体实现或系统安全策略上存在的缺陷，从而可以使攻击者能够在未授权的情况下对信息系统进行访问或破坏。漏洞一直是威胁信息系统安全的重要因素，层出不穷的漏洞对社会经济和大众隐私造成了巨大的威胁。随着代码规模的巨大化及逻辑的复杂化，漏洞的曝光频率越来越高，而不同漏洞对于信息系统的影响是不同的，有些漏洞被曝光后会被开发者忽略，而有些会被高度重视并及时修补。机器学习方法是在漏洞研究领域被应用的一类重要方法，其和文本挖掘的组合为研究者对漏洞进行评估分析提供了有力的支持。Hovsepyan等对利用JAVA写成的程序的源代码进行分析，构建可以表征源代码的词向量，并将这些词向量与相应的漏洞存在情况相对应，采用SVM等分类器来判断源代码中是否含有漏洞；Yamamoto等将LDA、SLDA等模型应用在爬取的NVD数据中，利用这些模型对爬取下的文本进行主题的提取，并利用提取的主题来对漏洞的特性进行描述。

本项目根据漏洞的文字描述，利用文本挖掘的方法提取其中的关键词，将高频词汇统计数及利用PCA对稀疏词汇降维的结果合并作为特征，构造可以将漏洞描述进行定量化表示的特征向量。利用从漏洞库中获取的XSS漏洞数据在多种分类算法下训练CNN模型进行实验，证明本方法在漏洞威胁程度评估方面的有效性。本项目在网络安全方面具有较高的学术价值和较宽广的应用前景，可以为漏洞分析、预测以及评估提供重要的参考价值和一定的研究思路。本项目的研究目标主要针对如何根据对于漏洞的简短描述来智能预测该漏洞的威胁程度。技术路线包括，对漏洞库中的某型漏洞的描述数据及其威胁程度进行爬取；利用文本挖掘的方法和主成分分析构建可以反映漏洞描述的特征向量；进行CNN机器学习分类器的训练；进行原型系统的设计制作本项目所提方法及案例进行实际应用，并在内网真实环境进行原型系统的实验。



## 4、研究资源 ##

- 在实际应用中，单纯依赖机器学习模型进行检测而忽视威胁情报会为攻击者的攻击埋下隐患。网络威胁情报（Cyber threat intelligence，CTI）是对传统网络安全的重要补充，对于研究人员来说，其可利用的威胁情报主要从开源网站上进行获取，这类威胁情报可以粗略划分为四种：IP地址信息、域名信息、漏洞数据库和开源情报信息库（例如有关安全的博客和论坛等）。在攻击检测过程中，可以直接自动化利用的是恶意IP地址库和恶意域名库，分属于粗分类的前两种。

- 恶意IP地址库是研究人员最容易获得的威胁情报之一，这些威胁情报被用于浏览器的访问黑名单中，当客户端发出的请求中包含这些地址时，浏览器便会进行阻拦。有很多公开网站发布恶意IP列表，其中，FireHOL 维护的恶意IP库是一个非常好的选择。FireHOL本身是Costa Tsaousis开发的用来对Linux内核防火墙的netfilter中IP表进行定制的一种shell脚本，其开发者提供了一个良好的恶意IP地址库，主要由四个来源的IP地址构成：fullbogons，出现在这些IP地址列表中的IP通常是DDOS攻击的来源，因此在一个路由器的路由表中这些地址不应该被添加进去；spamhaus drop and edrop，这个列表中包含了被专业的网络犯罪行动和钓鱼邮件使用后遗留下的IP；dshield，该IP地址包含了近三天排名前20的C类IP地址的攻击源IP；malware lists，顾名思义，是那些恶意软件或木马的常用网址。该综合IP地址库上的IP源地址会实时更新，并可以进行下载来对内部的应用IP地址库进行补充。

- 恶意域名库主要用于对僵尸网络、钓鱼页面和恶意软件进行防范。当一个用户访问的页面地址被包含在恶意域名列表中时，为用户安全考虑会对用户告警。很多网站都维护有向大众公开的相应的恶意域名库，在研究中可以从这些公开网站上获取相应数据。例如，PhishTank 是一个包含了众多钓鱼网址的网站，其由企业家David Ulevitch于2006年10月创办，是其主公司OpenDNS的一个分支，其主公司会利用自己开发的一套系统对用户请求检测的网站进行检测，并根据用户的投票来判断此网站是否为钓鱼网站，PhishTank上的大量记录由此而来。除此之外，还有DNS-BH project 、Malware Domain List等网站也提供了大量恶意域名信息。

- 常用的网络节点重要性排序指标有：度值、介数、接近中心性、k-壳值和特征向量等。其中，度值排序是一种局部排序方法，即网络中一个节点的度值越大则该节点越重要；介数是以经过某个节点的最短路径数量来评估节点重要性的方法，即经过某节点的最短路径数越多，该节点重要性越大；节点的接近中心性为节点与网络中其他节点距离平均值的倒数，即节点接近中心性越大则该节点越重要；k-壳分解是一种对网络中节点重要性粗粒化划分的方法；特征向量的基本思想为：网络中节点的重要性既与节点的度值大小有关，同时也与邻居节点的重要性有关。
- [https://en.wikipedia.org/wiki/Credal_network](https://en.wikipedia.org/wiki/Credal_network)
- Cozman F G. Credal networks[J]. Artificial Intelligence, 2000, 120(2):199-233.
- Vergari A, Mauro N D, Esposito F. Simplifying, Regularizing and Strengthening Sum-Product Network Structure Learning[C]// Joint European Conference on Machine Learning & Knowledge Discovery in Databases. 2015.

- 由于目前已有大量的贝叶斯网络学习研究，以及相关数据和构建好的实际应用模型，我们将利用这些公开的数据进行学习，并与实际模型相比较，从而对本项目的算法以及公开发表算法进行评价。比较有名的公开数据集包括：牛津大学的BN Learn（[http://www.bnlearn.com/](http://www.bnlearn.com/)），澳大利亚人工智能协会的ABNMS数据集（[http://abnms.org/bnrepo/](http://abnms.org/bnrepo/)），以色列希伯来大学的BN Repository（[http://www.cs.huji.ac.il/Repository/](http://www.cs.huji.ac.il/Repository/)），NORSYS软件公司的Net library数据集（[http://www.norsys.com/netlibrary/](http://- www.norsys.com/netlibrary/)），以及HUGIN公司的BN Forum数据集（[http://forum.hugin.com/](http://forum.hugin.com/)）等。

- 可以基于这些通用数据集中的贝叶斯网络模型，进行编程实验，并将软件工具包BNT（Bayes Net Toolbox for Matlab）集成到开发环境中，通过从真实模型中采样得到训练用目标数据集，通过引入一定的噪声采样产生源数据集，以便于进行多任务和迁移学习，实试验算法均在不同样本数据集上独立运行 100次进行测试。 在得到学习结果后，对不同学习算法进行评价，包括计算实验得到的网络与真实网络的结构编辑距离（将算法确定的最优图结构转化为标准的网络结构所需要的平均运算总数目），以及参数的K-L散度（Kullback–Leibler Divergence，用于计算概率分布之间的距离）等。


